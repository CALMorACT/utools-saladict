(window.saladictJSONP=window.saladictJSONP||[]).push([[6],{1270:function(e,t,s){e.exports=s(1293)},1273:function(e,t,s){},1293:function(e,t,s){"use strict";s.r(t);var r=s(0),o=s.n(r),n=s(18),i=s.n(n),a=s(889),h=s.n(a),c=s(890),l=s.n(c),d=s(891),u=s.n(d),g=s(3),p=s(676);const f=navigator.userAgent.includes("Firefox");class w extends r.PureComponent{constructor(){var e;super(...arguments),e=this,this.containerRef=r.createRef(),this.wavesurfer=void 0,this.region=void 0,this.soundTouch=void 0,this.soundTouchNode=void 0,this.shouldSTSync=!1,this.playOnLoad=!0,this.src=void 0,this.state={isPlaying:!1,speed:1,loop:!1,pitchStretch:!f},this.initSoundTouch=e=>{const t=e.backend.buffer,s=t.length,r=t.getChannelData(0),o=t.numberOfChannels>1?t.getChannelData(1):r;let n=0;const i={extract:(t,i,a)=>{this.shouldSTSync&&(n=~~(e.backend.getPlayedPercents()*s)-a,this.shouldSTSync=!1),a+=n;for(let e=0;e<i;e++)t[2*e]=r[e+a],t[2*e+1]=o[e+a];return Math.min(i,s-a)}};this.soundTouch=new p.b(e.backend.ac.sampleRate),this.soundTouchNode=Object(p.c)(e.backend.ac,new p.a(i,this.soundTouch)),e.backend.setFilter(this.soundTouchNode)},this.initWavesurfer=()=>{const e=h.a.create({container:this.containerRef.current,waveColor:"#f9690e",progressColor:"#B71C0C",plugins:[l.a.create()]});this.wavesurfer=e,e.enableDragSelection({}),e.on("region-created",e=>{this.removeRegion(),this.region=e}),e.on("region-update-end",this.play),e.on("region-out",this.onPlayEnd),e.on("seek",()=>{this.isInRegion()||this.removeRegion(),this.shouldSTSync=!0}),e.on("ready",this.onLoad),e.on("finish",this.onPlayEnd)},this.onLoad=()=>{this.playOnLoad&&this.play(),this.playOnLoad=!0},this.play=()=>{this.setState({isPlaying:!0}),this.wavesurfer&&(this.state.pitchStretch&&this.soundTouchNode&&this.wavesurfer.getFilters().length<=0&&this.wavesurfer.backend.setFilter(this.soundTouchNode),this.region&&!this.isInRegion()?this.wavesurfer.play(this.region.start):this.wavesurfer.play()),this.shouldSTSync=!0},this.pause=()=>{this.setState({isPlaying:!1}),this.soundTouchNode&&this.soundTouchNode.disconnect(),this.wavesurfer&&(this.wavesurfer.pause(),this.wavesurfer.backend.disconnectFilters())},this.togglePlay=()=>{this.state.isPlaying?this.pause():this.play()},this.onPlayEnd=()=>{this.state.loop?this.play():this.pause()},this.updateSpeed=e=>{this.setState({speed:e}),e<.1||e>3||(this.wavesurfer&&(this.wavesurfer.setPlaybackRate(e),1!==e&&this.state.pitchStretch&&!this.soundTouch&&this.initSoundTouch(this.wavesurfer),this.soundTouch&&(this.soundTouch.tempo=e)),this.shouldSTSync=!0)},this.toggleLoop=e=>{this.setState({loop:e.currentTarget.checked}),e.currentTarget.checked&&!this.state.isPlaying&&this.play()},this.togglePitchStretch=e=>{this.updatePitchStretch(e.currentTarget.checked),g.c.local.set({waveform_pitch:e.currentTarget.checked})},this.updatePitchStretch=e=>{this.setState({pitchStretch:e}),e?1!==this.state.speed&&this.soundTouchNode&&this.wavesurfer&&this.wavesurfer.getFilters().length<=0&&(this.wavesurfer.backend.setFilter(this.soundTouchNode),this.shouldSTSync=!0):(this.soundTouchNode&&this.soundTouchNode.disconnect(),this.wavesurfer&&this.wavesurfer.backend.disconnectFilters())},this.isInRegion=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.region;if(t&&e.wavesurfer){const s=e.wavesurfer.getCurrentTime();return s>=t.start&&s<=t.end}return!1},this.removeRegion=()=>{this.region&&this.region.remove(),this.region=null},this.reset=()=>{this.removeRegion(),this.updateSpeed(1),this.wavesurfer&&(this.wavesurfer.pause(),this.wavesurfer.empty(),this.wavesurfer.backend.disconnectFilters()),this.soundTouch&&(this.soundTouch.clear(),this.soundTouch.tempo=1),this.soundTouchNode&&this.soundTouchNode.disconnect(),this.soundTouch=null,this.soundTouchNode=null,this.shouldSTSync=!1},this.load=e=>{e?(this.wavesurfer?this.reset():this.initWavesurfer(),this.wavesurfer&&(this.wavesurfer.load(e),"suspended"===this.wavesurfer.backend.ac.state&&this.playOnLoad&&new Audio(e).play())):this.reset()}}async componentDidMount(){g.a.self.addListener("PLAY_AUDIO",async e=>{let{payload:t}=e;this.load(t)}),g.a.self.send({type:"LAST_PLAY_AUDIO"}).then(e=>{e&&e.src&&e.timestamp-Date.now()<1e4?this.load(e.src):(this.playOnLoad=!1,this.load("https://fanyi.sogou.com/reventondc/synthesis?text=Nothing%20to%20play&speed=1&lang=en&from=translateweb"))}),g.c.local.get("waveform_pitch").then(e=>{let{waveform_pitch:t}=e;null!=t&&this.updatePitchStretch(Boolean(t))})}componentWillUnmount(){this.reset(),this.wavesurfer&&(this.wavesurfer.destroy(),this.wavesurfer=null)}render(){return r.createElement("div",{className:"saladict-waveformWrap",style:this.props.rootStyles},r.createElement("div",{ref:this.containerRef}),r.createElement("div",{className:"saladict-waveformCtrl"},r.createElement("button",{type:"button",className:"saladict-waveformPlay",title:"Play/Pause",onClick:this.togglePlay},r.createElement("div",{className:"saladict-waveformPlay_FG".concat(this.state.isPlaying?" isPlaying":"")})),r.createElement(u.a,{className:"saladict-waveformSpeed",title:"Speed",value:this.state.speed,min:.1,max:3,step:.005,decimals:3,onValueChange:this.updateSpeed}),r.createElement("label",{className:"saladict-waveformBtn_label",title:"Loop"},this.state.loop?r.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:this.props.rootStyles.color},r.createElement("path",{d:"M23.242 388.417l162.59 120.596v-74.925h300.281l-.297-240.358-89.555-.239-.44 150.801H185.832l.81-75.934-163.4 120.06z"}),r.createElement("path",{d:"M490.884 120.747L328.294.15l.001 74.925H28.013l.297 240.358 89.555.239.44-150.801h209.99l-.81 75.934 163.4-120.06z"})):r.createElement("svg",{viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg",fill:this.props.rootStyles["--color-divider"]},r.createElement("path",{d:"M 23.242 388.417 L 23.243 388.417 L 23.242 388.418 Z M 23.243 388.418 L 186.642 268.358 L 185.832 344.292 L 283.967 344.292 L 331.712 434.088 L 185.832 434.088 L 185.832 509.013 Z M 395.821 344.292 L 396.261 193.491 L 485.816 193.73 L 486.113 434.088 L 388.064 434.088 L 340.319 344.292 Z"}),r.createElement("path",{d:"M 490.884 120.747 L 490.883 120.746 L 490.885 120.745 Z M 490.883 120.746 L 327.485 240.805 L 328.295 164.871 L 244.267 164.871 L 196.521 75.075 L 328.295 75.075 L 328.294 0.15 Z M 118.305 164.871 L 117.865 315.672 L 28.31 315.433 L 28.013 75.075 L 141.077 75.075 L 188.823 164.871 Z"}),r.createElement("rect",{x:"525.825",y:"9.264",width:"45.879",height:"644.398",transform:"matrix(0.882947, -0.469472, 0.469472, 0.882947, -403.998657, 225.106232)"})),r.createElement("input",{type:"checkbox",checked:this.state.loop,onChange:this.toggleLoop})),!f&&r.createElement("label",{className:"saladict-waveformPitch saladict-waveformBtn_label",title:"Pitch Stretch"},r.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 467.987 467.987",fill:this.state.pitchStretch?this.props.rootStyles.color:this.props.rootStyles["--color-divider"]},r.createElement("path",{d:"M70.01 146.717h47.924V321.27H70.01zM210.032 146.717h47.924V321.27h-47.924zM350.053 146.717h47.924V321.27h-47.924zM0 196.717h47.924v74.553H0zM280.042 196.717h47.924v74.553h-47.924zM420.063 196.717h47.924v74.553h-47.924zM140.021 96.717h47.924V371.27h-47.924z"})),r.createElement("input",{type:"checkbox",checked:this.state.pitchStretch,onChange:this.togglePitchStretch}))))}}var v=w;s(1273);const m=new URL(document.URL).searchParams,_=Boolean(m.get("darkmode")),y=_?{backgroundColor:"#222",color:"#ddd","--color-brand":"#218c74","--color-background":"#222","--color-rgb-background":"34, 34, 34","--color-font":"#ddd","--color-divider":"#4d4748"}:{backgroundColor:"#fff",color:"#333","--color-brand":"#5caf9e","--color-background":"#fff","--color-rgb-background":"255, 255, 255","--color-font":"#333","--color-divider":"#ddd"};i.a.render(o.a.createElement(v,{darkMode:_,rootStyles:y}),document.getElementById("root"))},3:function(e,t,s){"use strict";(function(e){s.d(t,"c",(function(){return l})),s.d(t,"a",(function(){return d})),s.d(t,"b",(function(){return u}));var r=s(153),o=s(23),n=s(11);const i=()=>{},a=new WeakMap,h=new WeakMap,c=new WeakMap,l={sync:{clear:g,remove:p,get:f,set:w,addListener:v,removeListener:m,createStream:_,get __storageArea__(){return"sync"}},local:{clear:g,remove:p,get:f,set:w,addListener:v,removeListener:m,createStream:_,get __storageArea__(){return"local"}},clear:g,addListener:v,removeListener:m,createStream:_,get __storageArea__(){return"all"}},d={send:y,addListener:L,removeListener:b,createStream:S,get __self__(){return!1},self:{initClient:T,initServer:function(){window.pageId="background page";const e=/^\[\[(.+)\]\]$/;browser.runtime.onMessage.addListener((t,s)=>{if(!t||!t.type)return;if("PAGE_INFO"===t.type)return Promise.resolve(function(e){const t={pageId:"",faviconURL:"",pageTitle:"",pageURL:""},s=e.tab;s?(t.pageId=s.id||"",s.favIconUrl&&(t.faviconURL=s.favIconUrl),s.url&&(t.pageURL=s.url),s.title&&(t.pageTitle=s.title)):(t.pageId="popup",e.url&&!e.url.startsWith("http")&&(t.faviconURL="https://saladict.crimx.com/favicon.ico"));return t}(s));const r=e.exec(t.type);if(r){t.type=r[1];const e=s.tab&&s.tab.id;return e?y(e,t):y(t)}})},send:async function(t){void 0===window.pageId&&await T();return browser.runtime.sendMessage(Object.assign({},t,{__pageId__:window.pageId,type:"[[".concat(t.type,"]]")})).catch(s=>{e.env.DEV_BUILD&&console.warn(s,t)})},addListener:L,removeListener:b,createStream:S,get __self__(){return!0}}};async function u(e,t){t&&(e=browser.runtime.getURL(e));const s=await browser.tabs.query({url:e});if(s.length>0){const{index:e,windowId:t}=s[0];"function"==typeof browser.tabs.highlight&&await browser.tabs.highlight({tabs:e,windowId:t}),await browser.windows.update(t,{focused:!0})}else await browser.tabs.create({url:e})}function g(){return"all"===this.__storageArea__?Promise.all([browser.storage.local.clear(),browser.storage.sync.clear()]).then(i):browser.storage[this.__storageArea__].clear()}function p(e){return browser.storage[this.__storageArea__].remove(e)}function f(){return browser.storage[this.__storageArea__].get(...arguments)}function w(e){return browser.storage[this.__storageArea__].set(e)}function v(){let e,t;if("function"==typeof(arguments.length<=0?void 0:arguments[0]))e="",t=arguments.length<=0?void 0:arguments[0];else{if("string"!=typeof(arguments.length<=0?void 0:arguments[0])||"function"!=typeof(arguments.length<=1?void 0:arguments[1]))throw new Error("wrong arguments type");e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1]}let s=c.get(t);s||(s=new Map,c.set(t,s));const r=this.__storageArea__+e;let o=s.get(r);return o||(o=(s,r)=>{"all"!==this.__storageArea__&&r!==this.__storageArea__||e&&!(e in s)||t(s,r)},s.set(r,o)),browser.storage.onChanged.addListener(o)}function m(){let e,t;if("function"==typeof(arguments.length<=0?void 0:arguments[0]))e="",t=arguments.length<=0?void 0:arguments[0];else{if("string"!=typeof(arguments.length<=0?void 0:arguments[0])||"function"!=typeof(arguments.length<=1?void 0:arguments[1]))throw new Error("wrong arguments type");e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1]}const s=c.get(t);if(s){if(!e)return s.forEach(e=>{browser.storage.onChanged.removeListener(e)}),void c.delete(t);{const r=this.__storageArea__+e,o=s.get(r);if(o)return browser.storage.onChanged.removeListener(o),s.delete(r),void(s.size<=0&&c.delete(t))}}browser.storage.onChanged.removeListener(t)}function _(e){if(!e)throw new Error("Missing key");return Object(r.a)(t=>this.addListener(e,t),t=>this.removeListener(e,t)).pipe(Object(o.a)(t=>(Array.isArray(t)?t[0]:t).hasOwnProperty(e)),Object(n.a)(t=>Array.isArray(t)?t[0][e]:t[e]))}function y(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return(1===s.length?browser.runtime.sendMessage(s[0]):browser.tabs.sendMessage(s[0],s[1])).catch(t=>{e.env.DEV_BUILD&&console.warn(t,...s)})}function L(){void 0===window.pageId&&T();const e=this.__self__?h:a,t=1===arguments.length?void 0:arguments.length<=0?void 0:arguments[0],s=1===arguments.length?arguments.length<=0?void 0:arguments[0]:arguments.length<=1?void 0:arguments[1];let r=e.get(s);r||(r=new Map,e.set(s,r));let o=r.get(t||"__DEFAULT_MSGTYPE__");return o||(o=(e,r)=>{if(e&&(this.__self__?window.pageId===e.__pageId__:!e.__pageId__)&&(null==t||e.type===t))return s(e,r)},r.set(t||"__DEFAULT_MSGTYPE__",o)),browser.runtime.onMessage.addListener(o)}function b(){const e=this.__self__?h:a,t=1===arguments.length?void 0:arguments.length<=0?void 0:arguments[0],s=1===arguments.length?arguments.length<=0?void 0:arguments[0]:arguments.length<=1?void 0:arguments[1],r=e.get(s);if(r){if(!t)return r.forEach(e=>browser.runtime.onMessage.removeListener(e)),void e.delete(s);{const o=r.get(t);if(o)return browser.runtime.onMessage.removeListener(o),r.delete(t),void(r.size<=0&&e.delete(s))}}browser.runtime.onMessage.removeListener(s)}function S(e){return(e?Object(r.a)(t=>this.addListener(e,t),t=>this.removeListener(e,t)):Object(r.a)(e=>this.addListener(e),e=>this.removeListener(e))).pipe(Object(n.a)(e=>Array.isArray(e)?e[0]:e))}function T(){return void 0===window.pageId?d.send({type:"PAGE_INFO"}).then(e=>{let{pageId:t,faviconURL:s,pageTitle:r,pageURL:o}=e;return window.pageId=t,window.faviconURL=s,r&&(window.pageTitle=r),o&&(window.pageURL=o),t}):Promise.resolve(window.pageId)}}).call(this,s(59))}},[[1270,0,18]]]);